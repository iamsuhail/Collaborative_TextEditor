{"ast":null,"code":"import _defineProperty from\"C:/Users/Muhammad suhail/Desktop/realtime-code-editor-main/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/Users/Muhammad suhail/Desktop/realtime-code-editor-main/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/Muhammad suhail/Desktop/realtime-code-editor-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Muhammad suhail/Desktop/realtime-code-editor-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Muhammad suhail\\\\Desktop\\\\realtime-code-editor-main\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";// EditorPage.js\nimport React,{useState,useRef,useEffect}from'react';import toast from'react-hot-toast';import ACTIONS from'../Actions';import Editor from'../components/Editor';import Video from'../components/Video';// Import the Video component\nimport{initSocket}from'../socket';import{useLocation,useNavigate,Navigate,useParams}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditorPage=function EditorPage(){var socketRef=useRef(null);var codeRef=useRef(null);var location=useLocation();var _useParams=useParams(),roomId=_useParams.roomId;var reactNavigator=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),clients=_useState2[0],setClients=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),userStreams=_useState4[0],setUserStreams=_useState4[1];useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _location$state;var handleErrors;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:handleErrors=function _handleErrors(e){console.log('socket error',e);toast.error('Socket connection failed, try again later.');reactNavigator('/');};_context.next=3;return initSocket();case 3:socketRef.current=_context.sent;socketRef.current.on('connect_error',function(err){return handleErrors(err);});socketRef.current.on('connect_failed',function(err){return handleErrors(err);});socketRef.current.emit(ACTIONS.JOIN,{roomId:roomId,username:(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username});// Listening for joined event\nsocketRef.current.on(ACTIONS.JOINED,function(_ref2){var _location$state2;var clients=_ref2.clients,username=_ref2.username,socketId=_ref2.socketId,stream=_ref2.stream;if(username!==((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.username)){toast.success(\"\".concat(username,\" joined the room.\"));console.log(\"\".concat(username,\" joined\"));}setClients(clients);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId:socketId});// Add the new user's stream\nhandleUserStream(socketId,stream);});// Listening for user stream event\nsocketRef.current.on(ACTIONS.USER_STREAM,function(_ref3){var socketId=_ref3.socketId,stream=_ref3.stream;handleUserStream(socketId,stream);});// Listening for disconnected\nsocketRef.current.on(ACTIONS.DISCONNECTED,function(_ref4){var socketId=_ref4.socketId,username=_ref4.username;toast.success(\"\".concat(username,\" left the room.\"));setClients(function(prev){return prev.filter(function(client){return client.socketId!==socketId;});});// Remove the user's stream on disconnect\nsetUserStreams(function(prevStreams){var newStreams=_objectSpread({},prevStreams);delete newStreams[socketId];return newStreams;});});case 10:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();return function(){socketRef.current.disconnect();socketRef.current.off(ACTIONS.JOINED);socketRef.current.off(ACTIONS.DISCONNECTED);};},[]);function copyRoomId(){return _copyRoomId.apply(this,arguments);}function _copyRoomId(){_copyRoomId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return navigator.clipboard.writeText(roomId);case 3:toast.success('Room ID has been copied to your clipboard');_context2.next=10;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);toast.error('Could not copy the Room ID');console.error(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return _copyRoomId.apply(this,arguments);}function leaveRoom(){reactNavigator('/');}// Function to handle user video stream\nvar handleUserStream=function handleUserStream(socketId,stream){setUserStreams(function(prevStreams){return _objectSpread(_objectSpread({},prevStreams),{},_defineProperty({},socketId,stream));});};if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"mainWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logoImage\",src:\"/logo.png\",alt:\"logo\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientsList\",children:clients.map(function(client){return/*#__PURE__*/_jsx(Video,{username:client.username,stream:userStreams[client.socketId],socket:socketRef.current// Pass the socket as a prop\n,roomId:roomId,isLocalUser:client.socketId===socketRef.current.id// Pass the roomId as a prop\n},client.socketId);})})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn copyBtn\",onClick:copyRoomId,children:\"Copy ROOM ID\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leaveBtn\",onClick:leaveRoom,children:\"Leave\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editorWrap\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:function onCodeChange(code){codeRef.current=code;}})})]});};export default EditorPage;","map":{"version":3,"sources":["C:/Users/Muhammad suhail/Desktop/realtime-code-editor-main/src/pages/EditorPage.js"],"names":["React","useState","useRef","useEffect","toast","ACTIONS","Editor","Video","initSocket","useLocation","useNavigate","Navigate","useParams","EditorPage","socketRef","codeRef","location","roomId","reactNavigator","clients","setClients","userStreams","setUserStreams","init","handleErrors","e","console","log","error","current","on","err","emit","JOIN","username","state","JOINED","socketId","stream","success","SYNC_CODE","code","handleUserStream","USER_STREAM","DISCONNECTED","prev","filter","client","prevStreams","newStreams","disconnect","off","copyRoomId","navigator","clipboard","writeText","leaveRoom","map","id"],"mappings":"6tBAAA;AAEA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,MAA1B,CAAkCC,SAAlC,KAAmD,OAAnD,CACA,MAAOC,CAAAA,KAAP,KAAkB,iBAAlB,CACA,MAAOC,CAAAA,OAAP,KAAoB,YAApB,CACA,MAAOC,CAAAA,MAAP,KAAmB,sBAAnB,CACA,MAAOC,CAAAA,KAAP,KAAkB,qBAAlB,CAA0C;AAC1C,OAASC,UAAT,KAA2B,WAA3B,CACA,OAASC,WAAT,CAAsBC,WAAtB,CAAmCC,QAAnC,CAA6CC,SAA7C,KAA8D,kBAA9D,C,wFAEA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACrB,GAAMC,CAAAA,SAAS,CAAGZ,MAAM,CAAC,IAAD,CAAxB,CACA,GAAMa,CAAAA,OAAO,CAAGb,MAAM,CAAC,IAAD,CAAtB,CACA,GAAMc,CAAAA,QAAQ,CAAGP,WAAW,EAA5B,CACA,eAAmBG,SAAS,EAA5B,CAAQK,MAAR,YAAQA,MAAR,CACA,GAAMC,CAAAA,cAAc,CAAGR,WAAW,EAAlC,CACA,cAA8BT,QAAQ,CAAC,EAAD,CAAtC,wCAAOkB,OAAP,eAAgBC,UAAhB,eACA,eAAsCnB,QAAQ,CAAC,EAAD,CAA9C,yCAAOoB,WAAP,eAAoBC,cAApB,eAEAnB,SAAS,CAAC,UAAM,CACZ,GAAMoB,CAAAA,IAAI,0FAAG,0CAKAC,CAAAA,YALA,iHAKAA,YALA,wBAKaC,CALb,CAKgB,CACrBC,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA4BF,CAA5B,EACArB,KAAK,CAACwB,KAAN,CAAY,4CAAZ,EACAV,cAAc,CAAC,GAAD,CAAd,CACH,CATQ,uBACiBV,CAAAA,UAAU,EAD3B,QACTM,SAAS,CAACe,OADD,eAETf,SAAS,CAACe,OAAV,CAAkBC,EAAlB,CAAqB,eAArB,CAAsC,SAACC,GAAD,QAASP,CAAAA,YAAY,CAACO,GAAD,CAArB,EAAtC,EACAjB,SAAS,CAACe,OAAV,CAAkBC,EAAlB,CAAqB,gBAArB,CAAuC,SAACC,GAAD,QAASP,CAAAA,YAAY,CAACO,GAAD,CAArB,EAAvC,EAQAjB,SAAS,CAACe,OAAV,CAAkBG,IAAlB,CAAuB3B,OAAO,CAAC4B,IAA/B,CAAqC,CACjChB,MAAM,CAANA,MADiC,CAEjCiB,QAAQ,kBAAElB,QAAQ,CAACmB,KAAX,0CAAE,gBAAgBD,QAFO,CAArC,EAKA;AACApB,SAAS,CAACe,OAAV,CAAkBC,EAAlB,CAAqBzB,OAAO,CAAC+B,MAA7B,CAAqC,eAA6C,yBAA1CjB,CAAAA,OAA0C,OAA1CA,OAA0C,CAAjCe,QAAiC,OAAjCA,QAAiC,CAAvBG,QAAuB,OAAvBA,QAAuB,CAAbC,MAAa,OAAbA,MAAa,CAC9E,GAAIJ,QAAQ,sBAAKlB,QAAQ,CAACmB,KAAd,2CAAK,iBAAgBD,QAArB,CAAZ,CAA2C,CACvC9B,KAAK,CAACmC,OAAN,WAAiBL,QAAjB,uBACAR,OAAO,CAACC,GAAR,WAAeO,QAAf,aACH,CACDd,UAAU,CAACD,OAAD,CAAV,CACAL,SAAS,CAACe,OAAV,CAAkBG,IAAlB,CAAuB3B,OAAO,CAACmC,SAA/B,CAA0C,CACtCC,IAAI,CAAE1B,OAAO,CAACc,OADwB,CAEtCQ,QAAQ,CAARA,QAFsC,CAA1C,EAKA;AACAK,gBAAgB,CAACL,QAAD,CAAWC,MAAX,CAAhB,CACH,CAbD,EAeA;AACAxB,SAAS,CAACe,OAAV,CAAkBC,EAAlB,CAAqBzB,OAAO,CAACsC,WAA7B,CAA0C,eAA0B,IAAvBN,CAAAA,QAAuB,OAAvBA,QAAuB,CAAbC,MAAa,OAAbA,MAAa,CAChEI,gBAAgB,CAACL,QAAD,CAAWC,MAAX,CAAhB,CACH,CAFD,EAIA;AACAxB,SAAS,CAACe,OAAV,CAAkBC,EAAlB,CAAqBzB,OAAO,CAACuC,YAA7B,CAA2C,eAA4B,IAAzBP,CAAAA,QAAyB,OAAzBA,QAAyB,CAAfH,QAAe,OAAfA,QAAe,CACnE9B,KAAK,CAACmC,OAAN,WAAiBL,QAAjB,qBACAd,UAAU,CAAC,SAACyB,IAAD,CAAU,CACjB,MAAOA,CAAAA,IAAI,CAACC,MAAL,CAAY,SAACC,MAAD,QAAYA,CAAAA,MAAM,CAACV,QAAP,GAAoBA,QAAhC,EAAZ,CAAP,CACH,CAFS,CAAV,CAIA;AACAf,cAAc,CAAC,SAAC0B,WAAD,CAAiB,CAC5B,GAAMC,CAAAA,UAAU,kBAAQD,WAAR,CAAhB,CACA,MAAOC,CAAAA,UAAU,CAACZ,QAAD,CAAjB,CACA,MAAOY,CAAAA,UAAP,CACH,CAJa,CAAd,CAKH,CAZD,EAtCS,uDAAH,kBAAJ1B,CAAAA,IAAI,0CAAV,CAoDAA,IAAI,GACJ,MAAO,WAAM,CACTT,SAAS,CAACe,OAAV,CAAkBqB,UAAlB,GACApC,SAAS,CAACe,OAAV,CAAkBsB,GAAlB,CAAsB9C,OAAO,CAAC+B,MAA9B,EACAtB,SAAS,CAACe,OAAV,CAAkBsB,GAAlB,CAAsB9C,OAAO,CAACuC,YAA9B,EACH,CAJD,CAKH,CA3DQ,CA2DN,EA3DM,CAAT,CATqB,QAsENQ,CAAAA,UAtEM,wIAsErB,gLAEcC,CAAAA,SAAS,CAACC,SAAV,CAAoBC,SAApB,CAA8BtC,MAA9B,CAFd,QAGQb,KAAK,CAACmC,OAAN,CAAc,2CAAd,EAHR,mFAKQnC,KAAK,CAACwB,KAAN,CAAY,4BAAZ,EACAF,OAAO,CAACE,KAAR,eANR,sEAtEqB,6CAgFrB,QAAS4B,CAAAA,SAAT,EAAqB,CACjBtC,cAAc,CAAC,GAAD,CAAd,CACH,CAED;AACA,GAAMwB,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACL,QAAD,CAAWC,MAAX,CAAsB,CAC3ChB,cAAc,CAAC,SAAC0B,WAAD,wCACRA,WADQ,wBAEVX,QAFU,CAECC,MAFD,IAAD,CAAd,CAIH,CALD,CAOA,GAAI,CAACtB,QAAQ,CAACmB,KAAd,CAAqB,CACjB,mBAAO,KAAC,QAAD,EAAU,EAAE,CAAC,GAAb,EAAP,CACH,CAED,mBACI,aAAK,SAAS,CAAC,UAAf,wBACI,aAAK,SAAS,CAAC,OAAf,wBACI,aAAK,SAAS,CAAC,YAAf,wBACI,YAAK,SAAS,CAAC,MAAf,uBACI,YAAK,SAAS,CAAC,WAAf,CAA2B,GAAG,CAAC,WAA/B,CAA2C,GAAG,CAAC,MAA/C,EADJ,EADJ,cAII,iCAJJ,cAKI,YAAK,SAAS,CAAC,aAAf,UACKhB,OAAO,CAACsC,GAAR,CAAY,SAACV,MAAD,qBACT,KAAC,KAAD,EAEI,QAAQ,CAAEA,MAAM,CAACb,QAFrB,CAGI,MAAM,CAAEb,WAAW,CAAC0B,MAAM,CAACV,QAAR,CAHvB,CAII,MAAM,CAAEvB,SAAS,CAACe,OAAU;AAJhC,CAKI,MAAM,CAAEZ,MALZ,CAMI,WAAW,CAAE8B,MAAM,CAACV,QAAP,GAAoBvB,SAAS,CAACe,OAAV,CAAkB6B,EAAe;AANtE,EACSX,MAAM,CAACV,QADhB,CADS,EAAZ,CADL,EALJ,GADJ,cAmBI,eAAQ,SAAS,CAAC,aAAlB,CAAgC,OAAO,CAAEe,UAAzC,0BAnBJ,cAsBI,eAAQ,SAAS,CAAC,cAAlB,CAAiC,OAAO,CAAEI,SAA1C,mBAtBJ,GADJ,cA2BI,YAAK,SAAS,CAAC,YAAf,uBACI,KAAC,MAAD,EACI,SAAS,CAAE1C,SADf,CAEI,MAAM,CAAEG,MAFZ,CAGI,YAAY,CAAE,sBAACwB,IAAD,CAAU,CACpB1B,OAAO,CAACc,OAAR,CAAkBY,IAAlB,CACH,CALL,EADJ,EA3BJ,GADJ,CAuCH,CAvID,CAyIA,cAAe5B,CAAAA,UAAf","sourcesContent":["// EditorPage.js\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport toast from 'react-hot-toast';\nimport ACTIONS from '../Actions';\nimport Editor from '../components/Editor';\nimport Video from '../components/Video';  // Import the Video component\nimport { initSocket } from '../socket';\nimport { useLocation, useNavigate, Navigate, useParams } from 'react-router-dom';\n\nconst EditorPage = () => {\n    const socketRef = useRef(null);\n    const codeRef = useRef(null);\n    const location = useLocation();\n    const { roomId } = useParams();\n    const reactNavigator = useNavigate();\n    const [clients, setClients] = useState([]);\n    const [userStreams, setUserStreams] = useState({});\n\n    useEffect(() => {\n        const init = async () => {\n            socketRef.current = await initSocket();\n            socketRef.current.on('connect_error', (err) => handleErrors(err));\n            socketRef.current.on('connect_failed', (err) => handleErrors(err));\n\n            function handleErrors(e) {\n                console.log('socket error', e);\n                toast.error('Socket connection failed, try again later.');\n                reactNavigator('/');\n            }\n\n            socketRef.current.emit(ACTIONS.JOIN, {\n                roomId,\n                username: location.state?.username,\n            });\n\n            // Listening for joined event\n            socketRef.current.on(ACTIONS.JOINED, ({ clients, username, socketId, stream }) => {\n                if (username !== location.state?.username) {\n                    toast.success(`${username} joined the room.`);\n                    console.log(`${username} joined`);\n                }\n                setClients(clients);\n                socketRef.current.emit(ACTIONS.SYNC_CODE, {\n                    code: codeRef.current,\n                    socketId,\n                });\n\n                // Add the new user's stream\n                handleUserStream(socketId, stream);\n            });\n\n            // Listening for user stream event\n            socketRef.current.on(ACTIONS.USER_STREAM, ({ socketId, stream }) => {\n                handleUserStream(socketId, stream);\n            });\n\n            // Listening for disconnected\n            socketRef.current.on(ACTIONS.DISCONNECTED, ({ socketId, username }) => {\n                toast.success(`${username} left the room.`);\n                setClients((prev) => {\n                    return prev.filter((client) => client.socketId !== socketId);\n                });\n\n                // Remove the user's stream on disconnect\n                setUserStreams((prevStreams) => {\n                    const newStreams = { ...prevStreams };\n                    delete newStreams[socketId];\n                    return newStreams;\n                });\n            });\n        };\n        init();\n        return () => {\n            socketRef.current.disconnect();\n            socketRef.current.off(ACTIONS.JOINED);\n            socketRef.current.off(ACTIONS.DISCONNECTED);\n        };\n    }, []);\n\n    async function copyRoomId() {\n        try {\n            await navigator.clipboard.writeText(roomId);\n            toast.success('Room ID has been copied to your clipboard');\n        } catch (err) {\n            toast.error('Could not copy the Room ID');\n            console.error(err);\n        }\n    }\n\n    function leaveRoom() {\n        reactNavigator('/');\n    }\n\n    // Function to handle user video stream\n    const handleUserStream = (socketId, stream) => {\n        setUserStreams((prevStreams) => ({\n            ...prevStreams,\n            [socketId]: stream,\n        }));\n    };\n\n    if (!location.state) {\n        return <Navigate to=\"/\" />;\n    }\n\n    return (\n        <div className=\"mainWrap\">\n            <div className=\"aside\">\n                <div className=\"asideInner\">\n                    <div className=\"logo\">\n                        <img className=\"logoImage\" src=\"/logo.png\" alt=\"logo\" />\n                    </div>\n                    <h3>Connected</h3>\n                    <div className=\"clientsList\">\n                        {clients.map((client) => (\n                            <Video\n                                key={client.socketId}\n                                username={client.username}\n                                stream={userStreams[client.socketId]}\n                                socket={socketRef.current}  // Pass the socket as a prop\n                                roomId={roomId} \n                                isLocalUser={client.socketId === socketRef.current.id}            // Pass the roomId as a prop\n                            />\n                        ))}\n                    </div>\n                </div>\n                <button className=\"btn copyBtn\" onClick={copyRoomId}>\n                    Copy ROOM ID\n                </button>\n                <button className=\"btn leaveBtn\" onClick={leaveRoom}>\n                    Leave\n                </button>\n            </div>\n            <div className=\"editorWrap\">\n                <Editor\n                    socketRef={socketRef}\n                    roomId={roomId}\n                    onCodeChange={(code) => {\n                        codeRef.current = code;\n                    }}\n                />\n            </div>\n        </div>\n    );\n};\n\nexport default EditorPage;\n"]},"metadata":{},"sourceType":"module"}